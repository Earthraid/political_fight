(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const L=6,E=["normal","special","confirm"];class H{constructor(){this.keyDown=new Set,this.keyPressed=new Set,this.keyMap=new Map,this.players={1:{held:new Set,pressed:new Set,buffer:new Map},2:{held:new Set,pressed:new Set,buffer:new Map}},this.installDefaultBindings(),window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e))}installDefaultBindings(){const e=[["a",{player:1,action:"left"}],["d",{player:1,action:"right"}],["w",{player:1,action:"jump"}],["j",{player:1,action:"normal"}],["l",{player:1,action:"special"}],["Enter",{player:1,action:"confirm"}],["ArrowLeft",{player:2,action:"left"}],["ArrowRight",{player:2,action:"right"}],["ArrowUp",{player:2,action:"jump"}],["n",{player:2,action:"normal"}],[",",{player:2,action:"special"}],["ShiftRight",{player:2,action:"confirm"}]];for(const[t,s]of e)this.keyMap.set(t,s)}normalizeKey(e){return e.code==="ShiftRight"?"ShiftRight":e.key.length===1?e.key.toLowerCase():e.key}handleKeyDown(e){const t=this.normalizeKey(e);this.keyDown.has(t)||this.keyPressed.add(t),this.keyDown.add(t)}handleKeyUp(e){const t=this.normalizeKey(e);this.keyDown.delete(t)}update(){for(const e of[1,2]){const t=this.players[e];t.pressed.clear(),t.held.clear();for(const s of E){const i=t.buffer.get(s)??0;i>0&&t.buffer.set(s,i-1)}}for(const e of this.keyDown){const t=this.keyMap.get(e);t&&this.players[t.player].held.add(t.action)}for(const e of this.keyPressed){const t=this.keyMap.get(e);if(!t)continue;const s=this.players[t.player];s.pressed.add(t.action),E.includes(t.action)&&s.buffer.set(t.action,L)}this.keyPressed.clear()}held(e,t){return this.players[e].held.has(t)}pressed(e,t){return this.players[e].pressed.has(t)}buffered(e,t){return(this.players[e].buffer.get(t)??0)>0}consumeBuffered(e,t){return this.buffered(e,t)?(this.players[e].buffer.set(t,0),!0):!1}pressedAny(e){return this.pressed(1,e)||this.pressed(2,e)}bufferedAny(e){return this.buffered(1,e)||this.buffered(2,e)}reset(){this.keyDown.clear(),this.keyPressed.clear();for(const e of[1,2])this.players[e].held.clear(),this.players[e].pressed.clear(),this.players[e].buffer.clear()}}const j=r=>`characters/${r}_portrait.svg`,B=r=>`characters/${r}_sprite.svg`,h=(r,e,t,s,i)=>({id:r,team:e,displayName:i??r,portraitPath:j(r),spritePath:B(r),stats:t,moves:s}),N=[h("Rump","RED",{walkSpeed:1.2,jumpVelocity:2,maxHP:12},{normal:{name:"Stupid Nickname",startup:4,active:2,recovery:10,knockback:4},special:{name:"Faux Patriotism",startup:8,active:4,recovery:14,knockback:12,notes:"Literally kiss a flag."}}),h("Balderdash","RED",{walkSpeed:4,jumpVelocity:5,maxHP:130},{normal:{name:"Walk in Parade",startup:5,active:2,recovery:11,knockback:5},special:{name:"Simp for Big Oil",startup:6,active:6,recovery:13,knockback:7,notes:"Poison communities for the 'greater good'.."}}),h("Morono","RED",{walkSpeed:3.7,jumpVelocity:7,maxHP:115},{normal:{name:"Shred Papers",startup:5,active:2,recovery:9,knockback:6},special:{name:"Deny Rights",startup:7,active:3,recovery:12,knockback:14,notes:"Freedom isn't free, it costs him a lot of money."}}),h("Prance","RED",{walkSpeed:2.7,jumpVelocity:9,maxHP:140},{normal:{name:"Dad Run",startup:4,active:2,recovery:10,knockback:4},special:{name:"Couch Toss",startup:8,active:5,recovery:15,knockback:8,notes:"'Tosses' a couch."}}),h("NormalHumanRed","RED",{walkSpeed:3,jumpVelocity:6,maxHP:120},{normal:{name:"Normal Punch",startup:6,active:2,recovery:10,knockback:5},special:{name:"Very Normal Move",startup:8,active:3,recovery:12,knockback:6}},"Normal Human"),h("Shoe","BLUE",{walkSpeed:4,jumpVelocity:2,maxHP:125},{normal:{name:"Push up Glasses",startup:4,active:2,recovery:10,knockback:5},special:{name:"Strongly Worded Letter",startup:7,active:4,recovery:13,knockback:9,notes:"Not much of a fighter."}}),h("Nandy","BLUE",{walkSpeed:4.5,jumpVelocity:5,maxHP:118},{normal:{name:"Don't Impeach",startup:4,active:2,recovery:9,knockback:4},special:{name:"Trade Stocks",startup:6,active:5,recovery:14,knockback:13,notes:"It's not illegal."}}),h("Jeppy","BLUE",{walkSpeed:3.9,jumpVelocity:10,maxHP:132},{normal:{name:"Plan",startup:5,active:2,recovery:11,knockback:6},special:{name:"Plan",startup:8,active:4,recovery:15,knockback:7,notes:"Things are very complicated."}}),h("Cinema","BLUE",{walkSpeed:3.6,jumpVelocity:8,maxHP:138},{normal:{name:"Obstruct",startup:4,active:2,recovery:10,knockback:5},special:{name:"Side With Republicans",startup:9,active:5,recovery:16,knockback:10,notes:"Caucuses blue."}}),h("NormalHumanBlue","BLUE",{walkSpeed:3,jumpVelocity:6,maxHP:120},{normal:{name:"Normal Punch",startup:6,active:2,recovery:10,knockback:5},special:{name:"Very Normal Move",startup:8,active:3,recovery:12,knockback:6}},"Normal Human")],f=N;new Map(N.map(r=>[r.id,r]));const C=new Map,P=r=>{const e=r;let t=C.get(e);return t||(t=new Image,t.src=r.startsWith("/")?r:`/${r}`,C.set(e,t)),t},F=(r,e)=>(r%e+e)%e;class I{constructor(e,t){this.game=e,this.input=t}enter(){}exit(){}update(e){this.input.pressedAny("confirm")&&this.game.setState("Select")}render(e){const{width:t,height:s}=e.canvas;e.clearRect(0,0,t,s),e.fillStyle="#e6e6e6",e.textAlign="center",e.font="48px sans-serif",e.fillText("Political Fight",t/2,s/2-20),e.font="20px sans-serif",e.fillText("Press Enter / Right Shift to Start",t/2,s/2+30)}}class x{constructor(e,t){this.game=e,this.input=t,this.selections={1:{index:0,locked:!1},2:{index:4,locked:!1}},this.warningText="",this.warningTimer=0,this.blockedIds=new Set(["Cinema","NormalHumanRed","NormalHumanBlue"])}enter(){for(const e of[1,2]){const t=this.game.selectedCharacters[e].id,s=f.findIndex(i=>i.id===t);this.selections[e].index=s>=0?s:this.selections[e].index,this.selections[e].locked=!1}}exit(){}move(e,t){const s=this.selections[e];s.locked||(s.index=F(s.index+t,f.length))}toggleLock(e){const t=this.selections[e];t.locked=!t.locked,t.locked&&this.game.setPlayerCharacter(e,f[t.index])}update(e){this.warningTimer=Math.max(0,this.warningTimer-e);for(const t of[1,2])if(this.input.pressed(t,"left")&&this.move(t,-1),this.input.pressed(t,"right")&&this.move(t,1),this.input.pressed(t,"jump")&&this.move(t,-5),this.input.pressed(t,"special")&&this.move(t,5),this.input.pressed(t,"confirm")){const s=f[this.selections[t].index];if(this.blockedIds.has(s.id)){this.warningText=s.id==="Cinema"?"Oops, wrong team":"Vote to Unlock",this.warningTimer=2;continue}this.toggleLock(t)}this.selections[1].locked&&this.selections[2].locked&&this.game.setState("Fight")}render(e){const{width:t,height:s}=e.canvas;e.clearRect(0,0,t,s),e.fillStyle="#0c0d14",e.fillRect(0,0,t,s),e.fillStyle="#e6e6e6",e.textAlign="center",e.font="32px sans-serif",e.fillText("Character Select",t/2,40),e.font="16px sans-serif",e.fillText("P1: A/D to move, W up a row, L special down, Enter lock | P2: Arrows / Up / Comma, Right Shift lock",t/2,65);const i=140,n=140,o=12,l=5,d=(t-(l*i+(l-1)*o))/2,p=70;f.forEach((m,a)=>{const c=a%l,v=Math.floor(a/l),g=d+c*(i+o),k=p+v*(n+o);e.save(),e.translate(g,k),e.fillStyle=m.team==="RED"?"#5a1a1a":"#162a60",e.fillRect(0,0,i,n),e.strokeStyle="#303040",e.lineWidth=3,e.strokeRect(0,0,i,n);const R=P(m.portraitPath);R.complete&&R.naturalWidth>0?e.drawImage(R,10,10,i-20,n-60):(e.fillStyle="#222",e.fillRect(10,10,i-20,n-60)),e.fillStyle="#f0f0f0",e.font="16px monospace",e.textAlign="left",e.fillText(m.displayName,12,n-22);const w=this.selections[1].index===a,u=this.selections[2].index===a;(w||u)&&(e.lineWidth=5,w&&(e.strokeStyle=this.selections[1].locked?"#7ef2ff":"#5fd0ff",e.strokeRect(3,3,i-6,n-6)),u&&(e.strokeStyle=this.selections[2].locked?"#ffe479":"#ffc857",e.strokeRect(8,8,i-16,n-16)));const M=n-12;w&&(e.fillStyle=this.selections[1].locked?"#7ef2ff":"#5fd0ff",e.font="14px monospace",e.textAlign="center",e.fillText(this.selections[1].locked?"P1 LOCKED":"P1",i/2-4,M)),u&&(e.fillStyle=this.selections[2].locked?"#ffe479":"#ffc857",e.font="14px monospace",e.textAlign="center",e.fillText(this.selections[2].locked?"P2 LOCKED":"P2",i/2+36,M)),e.restore()}),e.font="18px monospace",e.textAlign="center",e.fillStyle="#8bd3ff";const y=f[this.selections[1].index],S=f[this.selections[2].index];e.fillText(`P1 -> ${y.displayName}`,t/2-115,s-70),e.fillStyle="#ffde85",e.fillText(`P2 -> ${S.displayName}`,t/2+145,s-70),this.warningTimer>0&&(e.fillStyle="#ff6b6b",e.font="20px monospace",e.textAlign="center",e.fillText(this.warningText,t/2,s-80))}}class W{constructor(e,t){this.game=e,this.input=t,this.fighters=[],this.gravity=1100,this.moveScale=30,this.jumpScale=70,this.audienceMax=100,this.audience=this.audienceMax,this.audienceSprites=["/audience/person1.svg","/audience/person2.svg","/audience/person3.svg"],this.audienceSeats=[]}enter(){this.game.setResultMessage(""),this.resetAudience();const e=this.makeFighter(1,this.game.selectedCharacters[1],140),t=this.makeFighter(2,this.game.selectedCharacters[2],520);this.fighters=[e,t]}exit(){}makeFighter(e,t,s){return{id:e,character:t,x:s,y:200,w:70,h:100,vx:0,vy:0,onGround:!1,facing:e===1?1:-1,color:t.team==="RED"?"#ff8a8a":"#86b6ff",flashTimer:0,hitTimer:0,lastAction:"",lastActionTimer:0}}other(e){return this.fighters.find(t=>t!==e)}resetAudience(){this.audienceSeats=Array(this.audienceMax).fill(!0),this.audience=this.audienceMax}removeAudience(e){const t=this.audienceSeats.map((i,n)=>({filled:i,idx:n})).filter(i=>i.filled).map(i=>i.idx),s=Math.min(e,t.length);for(let i=0;i<s;i++){const n=Math.floor(Math.random()*t.length),o=t[n];this.audienceSeats[o]=!1,t.splice(n,1)}this.audience=this.audienceSeats.filter(Boolean).length}tryAttack(e,t){if(!this.input.pressed(e.id,t))return;const s=e.character.moves[t];e.lastAction=`${t.toUpperCase()}: ${s.name}`,e.lastActionTimer=1,e.flashTimer=.2;const i=this.other(e),n=90,o=70,l=e.x+e.w/2,d=e.y+e.h/2,p=i.x+i.w/2,y=i.y+i.h/2;if(Math.abs(l-p)<n&&Math.abs(d-y)<o){i.hitTimer=.25;const m=Math.floor(Math.random()*5)+3;this.removeAudience(m),this.audience===0&&(this.game.setResultMessage("Everyone loses"),this.game.setState("Results"))}}update(e){const t=this.game.canvas.height-70;for(const s of this.fighters){const i=s.character.stats.walkSpeed*this.moveScale,n=s.character.stats.jumpVelocity*this.jumpScale;s.vx=0,this.input.held(s.id,"left")&&(s.vx-=i,s.facing=-1),this.input.held(s.id,"right")&&(s.vx+=i,s.facing=1),this.input.pressed(s.id,"jump")&&s.onGround&&(s.vy=-n,s.onGround=!1),s.vy+=this.gravity*e,s.x+=s.vx*e,s.y+=s.vy*e,s.y+s.h>=t?(s.y=t-s.h,s.vy=0,s.onGround=!0):s.onGround=!1,s.x=Math.max(20,Math.min(this.game.canvas.width-s.w-20,s.x)),s.lastActionTimer=Math.max(0,s.lastActionTimer-e),s.flashTimer=Math.max(0,s.flashTimer-e),s.hitTimer=Math.max(0,s.hitTimer-e)}for(const s of this.fighters)this.tryAttack(s,"normal"),this.tryAttack(s,"special");this.input.pressedAny("confirm")&&(this.game.setResultMessage("Match ended early"),this.game.setState("Results"))}render(e){const{width:t,height:s}=e.canvas;e.clearRect(0,0,t,s),e.fillStyle="#0d0f16",e.fillRect(0,0,t,s);const i=190;e.fillStyle="#121828",e.fillRect(0,0,t,i);const n=8,o=12,l=18,d=20,p=2,y=o*l+(o-1)*p,S=(t-y)/2,m=8;for(let a=0;a<n;a++)for(let c=0;c<o;c++){const v=a*o+c,g=S+c*(l+p),k=m+a*(d+p);if(this.audienceSeats[v]??!1){const w=this.audienceSprites[(a*7+c*3+v)%this.audienceSprites.length],u=P(w);u.complete&&u.naturalWidth>0?e.drawImage(u,g,k,l,d):(e.fillStyle="#7ef2ff",e.fillRect(g,k,l,d))}else e.fillStyle="#1b2236",e.fillRect(g,k+d-8,l,8)}e.fillStyle="#1b2133",e.fillRect(0,s-60,t,60);for(const a of this.fighters){const c=P(a.character.spritePath);c.complete&&c.naturalWidth>0?(e.save(),e.translate(a.x+a.w/2,a.y),e.scale(a.facing,1),e.drawImage(c,-a.w/2,0,a.w,a.h),e.restore()):(e.fillStyle=a.color,e.fillRect(a.x,a.y,a.w,a.h)),a.flashTimer>0&&(e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(a.x,a.y,a.w,a.h)),a.hitTimer>0&&(e.fillStyle="rgba(255,80,80,0.3)",e.fillRect(a.x-5,a.y-5,a.w+10,a.h+10)),a.lastActionTimer>0&&(e.fillStyle="#e6e6e6",e.font="14px monospace",e.textAlign="center",e.fillText(a.lastAction,a.x+a.w/2,a.y-10))}e.fillStyle="#cccccc",e.font="14px sans-serif",e.textAlign="center",e.fillText("Move: A/D or Left/Right   Jump: W / Up   Normal: J / N   Special: L / ,   Shift/Enter to exit",t/2,s-24)}}class U{constructor(e,t){this.game=e,this.input=t}enter(){}exit(){}update(e){this.input.pressedAny("confirm")&&this.game.setState("Title")}render(e){const{width:t,height:s}=e.canvas;e.clearRect(0,0,t,s),e.fillStyle="#10121b",e.fillRect(0,0,t,s),e.textAlign="center",e.fillStyle="#e6e6e6",e.font="36px sans-serif",e.fillText("Results",t/2,s/2-60);const i=this.game.lastResultMessage||"Thanks for playing!";i==="Everyone loses"?(e.fillStyle="#ff4f4f",e.font="48px sans-serif",e.fillText(i,t/2,s/2)):(e.fillStyle="#e6e6e6",e.font="20px sans-serif",e.fillText(i,t/2,s/2)),e.fillStyle="#e6e6e6",e.font="18px sans-serif",e.fillText("Press Enter / Right Shift to return to Title",t/2,s/2+50)}}const T=800,A=480,b=1/60;class V{constructor(e){this.selectedCharacters={1:f[0],2:f[4]},this.lastResultMessage="",this.states=new Map,this.lastTime=0,this.accumulator=0,this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Could not get 2D context");this.ctx=t,this.canvas.width=T,this.canvas.height=A,this.input=new H,this.states.set("Title",new I(this,this.input)),this.states.set("Select",new x(this,this.input)),this.states.set("Fight",new W(this,this.input)),this.states.set("Results",new U(this,this.input)),this.setState("Title"),this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}setState(e){this.current&&this.current.exit(),this.current=this.states.get(e),this.currentName=e,this.current.enter(),this.input.reset()}handleResize(){const e=window.innerWidth,t=window.innerHeight,s=Math.min(e/T,t/A),i=Math.floor(T*s),n=Math.floor(A*s);this.canvas.style.width=i+"px",this.canvas.style.height=n+"px"}start(){this.lastTime=performance.now()/1e3,requestAnimationFrame(e=>this.frame(e))}frame(e){const t=e/1e3;let s=t-this.lastTime;for(s>.25&&(s=.25),this.lastTime=t,this.accumulator+=s;this.accumulator>=b;)this.update(b),this.accumulator-=b;const i=this.accumulator/b;this.render(i),requestAnimationFrame(n=>this.frame(n))}update(e){this.input.update(),this.current&&this.current.update(e)}render(e){this.current&&this.current.render(this.ctx),this.ctx.fillStyle="#e6e6e6",this.ctx.font="12px monospace",this.ctx.textAlign="left",this.ctx.fillText(`State: ${this.currentName}`,8,this.canvas.height-8)}setPlayerCharacter(e,t){this.selectedCharacters[e]=t}setResultMessage(e){this.lastResultMessage=e}}const D=document.getElementById("game-canvas");if(!D)throw new Error("No canvas element found with id 'game-canvas'");const O=new V(D);O.start();
